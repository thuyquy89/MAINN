<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω nh√¢n s·ª±</title>
    <style>
        :root {
            --gov-green: #3399FF;
            --gov-green-dark: #3399FF;
            --gov-red: #3399CC;
            --gov-gold: #f9a825;
            --bg-page: #f4f6f7;
            --text-main: #212121;
        }

        * { box-sizing: border-box; }

        body {
            font-family: "Arial", sans-serif;
            margin: 0;
            background: var(--bg-page);
            color: var(--text-main);
        }

        .top-bar { height: 6px; background: var(--gov-red); }

        .page-wrapper {
            max-width: 1100px;
            margin: 24px auto 32px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 3px 14px rgba(0,0,0,0.12);
            overflow: hidden;
        }

        .header-gov {
            background: linear-gradient(90deg, var(--gov-green-dark), var(--gov-green));
            color: #ffffff;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .gov-emblem {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            border: 2px solid var(--gov-gold);
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at 30% 30%, #ffffff, var(--gov-red));
            font-weight: bold;
            font-size: 26px;
            color: #fff;
            box-shadow: 0 0 0 2px rgba(0,0,0,0.2);
        }

        .gov-title-block { line-height: 1.3; }
        .gov-title-top { font-size: 12px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.9; }
        .gov-title-main { font-size: 18px; font-weight: 700; }
        .gov-title-sub { font-size: 13px; opacity: 0.9; }

        .system-bar {
            background: #eceff1;
            padding: 8px 24px;
            border-bottom: 1px solid #cfd8dc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .system-name {
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--gov-green-dark);
            font-weight: 600;
        }

        .system-user { font-size: 12px; color: #546e7a; }
        .system-user span { font-weight: 600; color: var(--gov-red); }

        .nav-bar { background: #ffffff; border-bottom: 1px solid #cfd8dc; padding: 0 24px; }
        .nav-list { list-style: none; margin: 0; padding: 0; display: flex; gap: 20px; }
        .nav-item a { display: block; padding: 10px 0; font-size: 13px; text-decoration: none; color: #455a64; border-bottom: 3px solid transparent; }
        .nav-item a:hover { color: var(--gov-green-dark); border-bottom-color: #b0bec5; }
        .nav-item a.active { color: var(--gov-green-dark); border-bottom-color: var(--gov-green); font-weight: 600; }

        .content { padding: 18px 24px 28px; }

        .section-title {
            margin-top: 16px;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: 600;
            color: var(--gov-green-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: "";
            width: 4px;
            height: 16px;
            border-radius: 2px;
            background: var(--gov-red);
        }

        .section-note { font-size: 12px; color: #757575; margin-bottom: 8px; }

        .panel { border: 1px solid #cfd8dc; border-radius: 6px; margin-bottom: 20px; background: #fafafa; }
        .panel-header { background: #eceff1; border-bottom: 1px solid #cfd8dc; padding: 8px 12px; font-size: 13px; font-weight: 600; text-transform: uppercase; color: #37474f; }
        .panel-body { padding: 12px 14px 10px; }

        .form-grid, .filter-grid { display: flex; flex-wrap: wrap; gap: 10px 24px; }

        .form-row, .filter-row {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 260px;
            margin-bottom: 8px;
        }

        .form-row label { width: 110px; font-size: 13px; color: #37474f; }
        .filter-row label { width: 90px; font-size: 13px; }

        .form-row input, .form-row select, .filter-row input, .filter-row select {
            flex: 1;
            padding: 5px 8px;
            font-size: 13px;
            border: 1px solid #b0bec5;
            border-radius: 3px;
            background: #ffffff;
            transition: border-color 0.15s, box-shadow 0.15s;
        }

        .form-row input:focus, .form-row select:focus, .filter-row input:focus, .filter-row select:focus {
            outline: none;
            border-color: var(--gov-green);
            box-shadow: 0 0 0 1px rgba(0,105,92,0.25);
        }

        .form-actions { margin-top: 8px; }

        .btn {
            padding: 6px 14px;
            border-radius: 3px;
            border: none;
            font-size: 13px;
            cursor: pointer;
            margin-right: 8px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary { background: var(--gov-green); color: #ffffff; }
        .btn-primary:hover { background: var(--gov-green-dark); }

        .btn-reset { background: #eceff1; color: #37474f; }
        .btn-reset:hover { background: #cfd8dc; }

        /* th√™m n√∫t ph·ª• cho ch·∫ø ƒë·ªô s·ª≠a */
        .btn-secondary { background: #fff3e0; color: #8d6e63; border: 1px solid #ffcc80; }
        .btn-secondary:hover { background: #ffe0b2; }

        .btn-icon { font-size: 14px; }

        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        thead { background: var(--gov-green-dark); color: #ffffff; }
        th, td { padding: 7px 10px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        th { text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; }

        tbody tr:nth-child(odd) { background: #ffffff; }
        tbody tr:nth-child(even) { background: #f5f5f5; }
        tbody tr:hover { background: #e8f5e9; }

        .tag-gender {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 500;
            color: #ffffff;
        }
        .tag-gender.male { background: #1976d2; }
        .tag-gender.female { background: #d81b60; }

        .tag-role {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 11px;
            background: rgba(249, 168, 37, 0.14);
            color: #bf7f00;
            border: 1px solid rgba(249, 168, 37, 0.6);
        }

        .note-list { font-size: 12px; margin: 4px 0 0 16px; }
        .note-list li { margin-bottom: 4px; }
        .footer-note { margin-top: 10px; font-size: 11px; color: #9e9e9e; text-align: right; }

        .stats-grid { display: flex; flex-wrap: wrap; gap: 12px; }
        .stat-card { flex: 1 1 160px; background: #ffffff; border-radius: 6px; border: 1px solid #e0e0e0; padding: 8px 10px; }
        .stat-label { font-size: 12px; color: #616161; }
        .stat-value { font-size: 20px; font-weight: 700; color: var(--gov-green-dark); margin-top: 4px; }
        .stat-sub { font-size: 11px; color: #9e9e9e; }

        /* nh·ªè g·ªçn cho n√∫t trong b·∫£ng */
        .table-actions .btn { padding: 5px 10px; margin-right: 6px; }
    </style>
</head>
<body>

<div class="top-bar"></div>

<div class="page-wrapper">
    <div class="header-gov">
        <div class="gov-emblem">VN</div>
        <div class="gov-title-block">
            <div class="gov-title-top">C√¥ng ty tr√°ch nhi·ªám h·ªØu h·∫°n 1 th√†nh vi√™n</div>
            <div class="gov-title-main">PH√íNG N·ªòI V·ª§ - C√îNG TY TNHH C√îNG NGH·ªÜ ABC</div>
            <div class="gov-title-sub">H·ªá th·ªëng qu·∫£n l√Ω, theo d√µi h·ªì s∆° c√°n b·ªô, nh√¢n vi√™n</div>
        </div>
    </div>

    <div class="system-bar">
        <div class="system-name">H·ªá th·ªëng qu·∫£n l√Ω nh√¢n s·ª± n·ªôi b·ªô</div>
        <div class="system-user">Ng∆∞·ªùi d√πng: <span>ADMIN_TEST</span></div>
    </div>

    <nav class="nav-bar">
        <ul class="nav-list">
            <li class="nav-item"><a href="nhansu.html" class="active">Qu·∫£n l√Ω nh√¢n s·ª±</a></li>
            <li class="nav-item"><a href="phongban.html">Qu·∫£n l√Ω ph√≤ng ban</a></li>
            <li class="nav-item"><a href="chamcong.html">B·∫£ng ch·∫•m c√¥ng</a></li>
            <li class="nav-item"><a href="hosonhanvien.html">H·ªì s∆° nh√¢n vi√™n</a></li>
            <li class="nav-item"><a href="ot.html">L√†m th√™m gi·ªù (OT) </a></li>
            <li class="nav-item"><a href="admin_it.html">Qu·∫£n tr·ªã h·ªá th·ªëng</a></li>
        </ul>
    </nav>

    <div class="content">
        <div class="section-title">Th·ªëng k√™ nhanh</div>
        <div class="section-note">
            S·ªë li·ªáu t·ªïng h·ª£p s∆° b·ªô d·ª±a tr√™n danh s√°ch nh√¢n s·ª± ƒëang ƒë∆∞·ª£c qu·∫£n l√Ω tr√™n h·ªá th·ªëng.
        </div>

        <div class="panel">
            <div class="panel-header">T·ªïng quan nh√¢n s·ª±</div>
            <div class="panel-body">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">T·ªïng s·ªë nh√¢n s·ª±</div>
                        <div class="stat-value" id="statTotal">0</div>
                        <div class="stat-sub">Bao g·ªìm c·∫£ h·ª£p ƒë·ªìng v√† bi√™n ch·∫ø</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Nh√¢n s·ª± nam</div>
                        <div class="stat-value" id="statMale">0</div>
                        <div class="stat-sub">Theo th√¥ng tin gi·ªõi t√≠nh khai b√°o</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Nh√¢n s·ª± n·ªØ</div>
                        <div class="stat-value" id="statFemale">0</div>
                        <div class="stat-sub">Bao g·ªìm c·∫£ ch·ª©c danh chuy√™n m√¥n</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ch∆∞a c·∫≠p nh·∫≠t l∆∞∆°ng</div>
                        <div class="stat-value" id="statNoSalary">0</div>
                        <div class="stat-sub">C·∫ßn b·ªï sung th√¥ng tin h·ªá s·ªë l∆∞∆°ng</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section-title">Th√¥ng tin nh√¢n s·ª±</div>
        <div class="section-note">
            Nh·∫≠p ƒë·∫ßy ƒë·ªß, ch√≠nh x√°c c√°c tr∆∞·ªùng th√¥ng tin c∆° b·∫£n ƒë·ªÉ ph·ª•c v·ª• c√¥ng t√°c qu·∫£n l√Ω, theo d√µi.
        </div>

        <div class="panel">
            <div class="panel-header">Phi·∫øu nh·∫≠p th√¥ng tin nh√¢n s·ª±</div>
            <div class="panel-body">
                <div class="form-grid">
                    <div class="form-row">
                        <label for="maNv">M√£ nh√¢n vi√™n:</label>
                        <input type="text" id="maNv" name="maNv" placeholder="VD: NV005">
                    </div>
                    <div class="form-row">
                        <label for="hoTen">H·ªç v√† t√™n:</label>
                        <input type="text" id="hoTen" name="hoTen" placeholder="Nh·∫≠p h·ªç v√† t√™n">
                    </div>
                    <div class="form-row">
                        <label for="chucDanh">Ch·ª©c danh:</label>
                        <input type="text" id="chucDanh" name="chucDanh" placeholder="VD: Chuy√™n vi√™n, L·∫≠p tr√¨nh vi√™n">
                    </div>
                    <div class="form-row">
                        <label for="ngaySinh">Ng√†y sinh:</label>
                        <input type="date" id="ngaySinh" name="ngaySinh">
                    </div>
                    <div class="form-row">
                        <label for="gioiTinh">Gi·ªõi t√≠nh:</label>
                        <select id="gioiTinh" name="gioiTinh">
                            <option value="">-- Ch·ªçn --</option>
                            <option value="Nam">Nam</option>
                            <option value="N·ªØ">N·ªØ</option>
                            <option value="Kh√°c">Kh√°c</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="heSoLuong">H·ªá s·ªë l∆∞∆°ng:</label>
                        <input type="number" step="0.1" id="heSoLuong" name="heSoLuong" placeholder="VD: 3.20">
                    </div>
                </div>

                <!-- hidden state: ƒëang s·ª≠a nh√¢n vi√™n n√†o -->
                <input type="hidden" id="editingId" value="">

                <div class="form-actions">
                    <button type="button" class="btn btn-primary" id="btnSubmit">
                        <span class="btn-icon">‚úî</span> Ghi nh·∫≠n
                    </button>
                    <button type="reset" class="btn btn-reset" id="btnReset">
                        <span class="btn-icon">‚Ü∫</span> L√†m l·∫°i
                    </button>

                    <!-- N√öT H·ª¶Y S·ª¨A: ch·ªâ hi·ªán khi ƒëang s·ª≠a -->
                    <button type="button" class="btn btn-secondary" id="btnCancelEdit" style="display:none;">
                        <span class="btn-icon">‚§∫</span> H·ªßy s·ª≠a
                    </button>
                </div>
            </div>
        </div>

        <div class="section-title">Danh s√°ch nh√¢n s·ª±</div>
        <div class="section-note">
            D·ªØ li·ªáu minh h·ªça ph·ª•c v·ª• m·ª•c ƒë√≠ch th·ª≠ nghi·ªám giao di·ªán.
        </div>

        <div class="panel">
            <div class="panel-header">B·∫£ng t·ªïng h·ª£p nh√¢n s·ª±</div>
            <div class="panel-body">
                <table>
                    <thead>
                    <tr>
                        <th>M√£ NV</th>
                        <th>H·ªç v√† t√™n</th>
                        <th>Ch·ª©c danh</th>
                        <th>Ng√†y sinh</th>
                        <th>Gi·ªõi t√≠nh</th>
                        <th>H·ªá s·ªë l∆∞∆°ng</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                    </thead>
                    <tbody id="employeeTableBody">
                    <tr>
                        <td colspan="7" style="text-align: center; color: #9e9e9e;">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="footer-note">
            Giao di·ªán m√¥ ph·ªèng ph·ª•c v·ª• m·ª•c ƒë√≠ch h·ªçc t·∫≠p, kh√¥ng ph·∫£i h·ªá th·ªëng ch√≠nh th·ª©c.
        </div>
    </div>
</div>

<script>
    const API_URL = 'http://localhost:3000/api';

    document.addEventListener('DOMContentLoaded', function() {
        loadEmployees();
        loadStatistics();

        document.getElementById('btnSubmit').addEventListener('click', handleSubmit);
        document.getElementById('btnReset').addEventListener('click', handleReset);
        document.getElementById('btnCancelEdit').addEventListener('click', cancelEditMode);
    });

    async function loadEmployees() {
        try {
            const response = await fetch(`${API_URL}/employees`);
            const result = await response.json();

            if (result.success) {
                displayEmployees(result.data);
            } else {
                alert('L·ªói t·∫£i d·ªØ li·ªáu');
            }
        } catch (error) {
            console.error('Error loading employees:', error);
            const tbody = document.getElementById('employeeTableBody');
            tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #e53935;">Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng kh·ªüi ƒë·ªông server.</td></tr>';
        }
    }

    function displayEmployees(employees) {
        const tbody = document.getElementById('employeeTableBody');

        if (employees.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #9e9e9e;">Ch∆∞a c√≥ d·ªØ li·ªáu nh√¢n vi√™n</td></tr>';
            return;
        }

        tbody.innerHTML = employees.map(emp => `
            <tr>
                <td>${emp.maNv || ''}</td>
                <td>${emp.hoTen || ''}</td>
                <td><span class="tag-role">${emp.chucDanh || '‚Äî'}</span></td>
                <td>${formatDate(emp.ngaySinh)}</td>
                <td>${formatGender(emp.gioiTinh)}</td>
                <td>${emp.heSoLuong || '‚Äî'}</td>
                <td class="table-actions">
                    <button class="btn btn-secondary" type="button"
                        onclick="startEditEmployee(${emp.id}, '${escapeQuotes(emp.maNv || '')}', '${escapeQuotes(emp.hoTen || '')}', '${escapeQuotes(emp.chucDanh || '')}', '${escapeQuotes(emp.ngaySinh || '')}', '${escapeQuotes(emp.gioiTinh || '')}', '${escapeQuotes(emp.heSoLuong ?? '')}')">
                        ‚úè S·ª≠a
                    </button>
                    <button class="btn btn-reset" type="button"
                        onclick="deleteEmployee(${emp.id}, '${escapeQuotes(emp.hoTen || '')}', '${escapeQuotes(emp.maNv || '')}')">
                        üóë X√≥a
                    </button>
                </td>
            </tr>
        `).join('');
    }

    async function loadStatistics() {
        try {
            const response = await fetch(`${API_URL}/statistics`);
            const result = await response.json();

            if (result.success) {
                document.getElementById('statTotal').textContent = result.data.total || 0;
                document.getElementById('statMale').textContent = result.data.male || 0;
                document.getElementById('statFemale').textContent = result.data.female || 0;
                document.getElementById('statNoSalary').textContent = result.data.noSalary || 0;
            }
        } catch (error) {
            console.error('Error loading statistics:', error);
        }
    }

    // ====== ADD / UPDATE ======
    async function handleSubmit() {
        const editingId = document.getElementById('editingId').value;

        const formData = {
            maNv: document.getElementById('maNv').value.trim(),
            hoTen: document.getElementById('hoTen').value.trim(),
            chucDanh: document.getElementById('chucDanh').value.trim(),
            ngaySinh: document.getElementById('ngaySinh').value,
            gioiTinh: document.getElementById('gioiTinh').value,
            heSoLuong: document.getElementById('heSoLuong').value
        };

        if (!formData.maNv || !formData.hoTen) {
            alert('Vui l√≤ng nh·∫≠p M√£ nh√¢n vi√™n v√† H·ªç t√™n');
            return;
        }

        try {
            // N·∫øu ƒëang s·ª≠a -> PUT, kh√¥ng s·ª≠a -> POST
            const url = editingId ? `${API_URL}/employees/${editingId}` : `${API_URL}/employees`;
            const method = editingId ? 'PUT' : 'POST';

            const response = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });

            const result = await response.json();

            if (result.success) {
                alert(editingId ? 'C·∫≠p nh·∫≠t nh√¢n vi√™n th√†nh c√¥ng!' : 'ƒê√£ th√™m nh√¢n vi√™n th√†nh c√¥ng!');
                cancelEditMode();     // tho√°t ch·∫ø ƒë·ªô s·ª≠a + reset form
                loadEmployees();
                loadStatistics();
            } else {
                alert('L·ªói: ' + (result.error || 'Kh√¥ng x√°c ƒë·ªãnh'));
            }
        } catch (error) {
            console.error('Error submitting form:', error);
            alert('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng ki·ªÉm tra server ƒëang ch·∫°y.');
        }
    }

    function handleReset() {
        // reset form
        document.getElementById('maNv').value = '';
        document.getElementById('hoTen').value = '';
        document.getElementById('chucDanh').value = '';
        document.getElementById('ngaySinh').value = '';
        document.getElementById('gioiTinh').value = '';
        document.getElementById('heSoLuong').value = '';
    }

    // ====== EDIT MODE ======
    function startEditEmployee(id, maNv, hoTen, chucDanh, ngaySinh, gioiTinh, heSoLuong) {
        document.getElementById('editingId').value = id;

        document.getElementById('maNv').value = maNv || '';
        document.getElementById('hoTen').value = hoTen || '';
        document.getElementById('chucDanh').value = chucDanh || '';
        document.getElementById('ngaySinh').value = ngaySinh || '';
        document.getElementById('gioiTinh').value = gioiTinh || '';
        document.getElementById('heSoLuong').value = (heSoLuong === 'null' || heSoLuong === 'undefined') ? '' : (heSoLuong ?? '');

        // ƒë·ªïi text n√∫t submit + hi·ªán n√∫t h·ªßy
        document.getElementById('btnSubmit').innerHTML = '<span class="btn-icon">üíæ</span> C·∫≠p nh·∫≠t';
        document.getElementById('btnCancelEdit').style.display = 'inline-flex';

        // k√©o l√™n form cho d·ªÖ nh√¨n
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function cancelEditMode() {
        document.getElementById('editingId').value = '';
        handleReset();

        document.getElementById('btnSubmit').innerHTML = '<span class="btn-icon">‚úî</span> Ghi nh·∫≠n';
        document.getElementById('btnCancelEdit').style.display = 'none';
    }

    // ====== DELETE ======
    async function deleteEmployee(id, hoTen, maNv) {
        const ok = confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a nh√¢n vi√™n:\n- M√£: ${maNv}\n- T√™n: ${hoTen}\n\nH√†nh ƒë·ªông n√†y s·∫Ω x√≥a kh·ªèi database!`);
        if (!ok) return;

        try {
            const res = await fetch(`${API_URL}/employees/${id}`, { method: 'DELETE' });
            const result = await res.json();

            if (result.success) {
                alert('ƒê√£ x√≥a nh√¢n vi√™n th√†nh c√¥ng!');
                // n·∫øu ƒëang s·ª≠a ƒë√∫ng ng∆∞·ªùi v·ª´a x√≥a -> tho√°t ch·∫ø ƒë·ªô s·ª≠a
                const editingId = document.getElementById('editingId').value;
                if (editingId && String(editingId) === String(id)) cancelEditMode();

                loadEmployees();
                loadStatistics();
            } else {
                alert('L·ªói: ' + (result.error || 'Kh√¥ng x√°c ƒë·ªãnh'));
            }
        } catch (err) {
            console.error(err);
            alert('Kh√¥ng th·ªÉ k·∫øt n·ªëi server ƒë·ªÉ x√≥a. H√£y ki·ªÉm tra server ƒëang ch·∫°y.');
        }
    }

    // ====== HELPERS ======
    function escapeQuotes(str) {
        return String(str).replace(/'/g, "\\'").replace(/"/g, '\\"');
    }

    function formatDate(dateStr) {
        if (!dateStr) return '‚Äî';
        const date = new Date(dateStr);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
    }

    function formatGender(gender) {
        if (!gender) return '‚Äî';
        if (gender === 'Nam') return '<span class="tag-gender male">Nam</span>';
        if (gender === 'N·ªØ') return '<span class="tag-gender female">N·ªØ</span>';
        return gender;
    }
</script>

</body>
</html>
